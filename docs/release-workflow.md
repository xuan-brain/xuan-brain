# GitHub Actions Workflows

æœ¬æ–‡æ¡£ä»‹ç»äº† xuan-brain é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒæµç¨‹ã€‚

## æ¦‚è¿°

é¡¹ç›®ä½¿ç”¨ GitHub Actions å®ç°äº†ä¸¤ç§è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹ï¼š

1. **Release Build** - æ­£å¼ç‰ˆæœ¬å‘å¸ƒæ„å»º
2. **Nightly Build** - æ¯æ—¥è‡ªåŠ¨æ„å»ºæœ€æ–°å¼€å‘ç‰ˆæœ¬

## Nightly Build (æ¯æ—¥æ„å»º)

### å·¥ä½œæµæ–‡ä»¶

ä½ç½®: `.github/workflows/nightly.yml`

### è§¦å‘æ¡ä»¶

- **å®šæ—¶è§¦å‘**: æ¯å¤© UTC æ—¶é—´ 00:00ï¼ˆåŒ—äº¬æ—¶é—´ 08:00ï¼‰è‡ªåŠ¨æ„å»º
- **æ‰‹åŠ¨è§¦å‘**: å¯ä»¥åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

### æ„å»ºè¯´æ˜

Nightly Build ç”¨äºï¼š
- æŒç»­é›†æˆæœ€æ–°ä»£ç æ›´æ”¹
- æå‰å‘ç°æ½œåœ¨é—®é¢˜
- ä¸ºæµ‹è¯•äººå‘˜æä¾›æœ€æ–°ç‰ˆæœ¬

### ğŸ†• Nightly Release

ä»ç°åœ¨å¼€å§‹ï¼Œæ¯æ¬¡ Nightly Build æˆåŠŸåä¼š**è‡ªåŠ¨åˆ›å»º/æ›´æ–°ä¸€ä¸ªåä¸º "nightly" çš„ GitHub Release**ï¼š

#### ç‰¹ç‚¹

- **å›ºå®šæ ‡ç­¾**: ä½¿ç”¨å›ºå®šçš„ `nightly` æ ‡ç­¾ï¼Œæ¯æ¬¡æ„å»ºä¼šæ›´æ–°è¿™ä¸ª Release
- **é¢„å‘å¸ƒç‰ˆæœ¬**: æ ‡è®°ä¸º `prerelease: true`ï¼Œä¸ä¼šè¢«è§†ä¸ºæ­£å¼ç‰ˆæœ¬
- **è‡ªåŠ¨æ›´æ–°**: æ¯å¤©çš„æ„å»ºä¼šè¦†ç›–ä¹‹å‰çš„ nightly Release
- **åŒ…å«æ„å»ºä¿¡æ¯**: Release è¯´æ˜ä¸­åŒ…å«æ„å»ºç¼–å·ã€æäº¤å“ˆå¸Œç­‰ä¿¡æ¯
- **ç›´æ¥ä¸‹è½½**: æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…ç›´æ¥ä¸Šä¼ åˆ° Releaseï¼Œæ— éœ€ç™»å½•å³å¯ä¸‹è½½

#### å¦‚ä½•è·å– Nightly Build

**æ–¹å¼ä¸€ï¼šé€šè¿‡ Nightly Release ä¸‹è½½ï¼ˆæ¨èï¼‰**

1. è®¿é—®ä»“åº“çš„ [Releases](https://github.com/xuan-brain/xuan-brain/releases) é¡µé¢
2. æ‰¾åˆ°æ ‡è®°ä¸º **"Pre-release"** çš„ "nightly" ç‰ˆæœ¬
3. åœ¨ "Assets" éƒ¨åˆ†ä¸‹è½½å¯¹åº”å¹³å°çš„å®‰è£…åŒ…ï¼š
   - Linux: `.AppImage` å’Œ `.deb` åŒ…
   - macOS: `.dmg` (Intel å’Œ Apple Silicon ç‰ˆæœ¬)
   - Windows: `.msi` å’Œ `.exe` å®‰è£…åŒ…
4. æ— éœ€ç™»å½• GitHub å³å¯ä¸‹è½½

**æ–¹å¼äºŒï¼šé€šè¿‡ GitHub Actions Artifacts ä¸‹è½½**

1. è®¿é—®ä»“åº“çš„ [Actions](https://github.com/xuan-brain/xuan-brain/actions) é¡µé¢
2. ç‚¹å‡» "Nightly Build" å·¥ä½œæµ
3. é€‰æ‹©æœ€æ–°çš„æˆåŠŸè¿è¡Œ
4. åœ¨ "Artifacts" éƒ¨åˆ†ä¸‹è½½å¯¹åº”å¹³å°çš„æ„å»ºäº§ç‰©ï¼š
   - `nightly-linux-x86_64` - Linux AppImage å’Œ deb åŒ…
   - `nightly-macos-x86_64` - macOS Intel ç‰ˆæœ¬
   - `nightly-macos-aarch64` - macOS Apple Silicon ç‰ˆæœ¬
   - `nightly-windows-x86_64` - Windows MSI å’Œ EXE å®‰è£…åŒ…
5. æ³¨æ„ï¼šéœ€è¦ç™»å½• GitHub æ‰èƒ½ä¸‹è½½ Artifacts

### æ„å»ºäº§ç‰©ä¿ç•™æœŸ

- **Nightly Release**: æŒç»­æ›´æ–°ï¼Œå§‹ç»ˆä¿æŒæœ€æ–°ç‰ˆæœ¬å¯ç”¨
- **GitHub Actions Artifacts**: ä¿ç•™ **7 å¤©**ï¼Œä¹‹åè‡ªåŠ¨åˆ é™¤

### æ‰‹åŠ¨è§¦å‘ Nightly Build

1. è®¿é—® [Actions](https://github.com/xuan-brain/xuan-brain/actions) é¡µé¢
2. ç‚¹å‡» "Nightly Build" å·¥ä½œæµ
3. ç‚¹å‡»å³ä¾§çš„ "Run workflow" æŒ‰é’®
4. é€‰æ‹©åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯ `main`ï¼‰
5. ç‚¹å‡»ç»¿è‰²çš„ "Run workflow" æŒ‰é’®

æ„å»ºå®Œæˆåä¼šè‡ªåŠ¨æ›´æ–° "nightly" Release

---

## Release Build (æ­£å¼å‘å¸ƒ)

### å·¥ä½œæµæ–‡ä»¶

ä½ç½®: `.github/workflows/release.yml`

## è§¦å‘æ¡ä»¶

å·¥ä½œæµåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è§¦å‘:
- å½“æ¨é€ä»¥ `v` å¼€å¤´çš„ tag æ—¶ï¼ˆä¾‹å¦‚ï¼š`v0.1.0`, `v1.2.3`ï¼‰
- Workflow ä¼šè‡ªåŠ¨åˆ›å»º GitHub Release å¹¶ä¸Šä¼ æ„å»ºäº§ç‰©

## æ„å»ºå¹³å°

ä¸¤ä¸ªå·¥ä½œæµéƒ½ä¼šä¸ºä»¥ä¸‹å¹³å°æ„å»ºå®‰è£…åŒ…:

### Linux
- **æ¶æ„**: x86_64
- **è¿è¡Œç¯å¢ƒ**: Ubuntu 22.04
- **è¾“å‡ºæ ¼å¼**: `.AppImage`, `.deb`

### macOS
- **Intel æ¶æ„**: x86_64
- **Apple Silicon**: aarch64 (M1/M2/M3)
- **è¿è¡Œç¯å¢ƒ**: macOS latest
- **è¾“å‡ºæ ¼å¼**: `.dmg`, `.app` bundle

### Windows
- **æ¶æ„**: x86_64
- **è¿è¡Œç¯å¢ƒ**: Windows latest
- **è¾“å‡ºæ ¼å¼**: `.msi`, `.exe`

## æ„å»ºæ­¥éª¤

æ¯ä¸ªå¹³å°çš„æ„å»ºæµç¨‹åŒ…æ‹¬:

1. **æ£€å‡ºä»£ç **: å…‹éš†ä»“åº“ä»£ç 
2. **è®¾ç½® Node.js**: å®‰è£… Node.js 24
3. **å®‰è£… Yarn**: å…¨å±€å®‰è£… Yarn åŒ…ç®¡ç†å™¨
4. **è®¾ç½® Rust**: å®‰è£… Rust å·¥å…·é“¾å’Œç›®æ ‡å¹³å°
5. **Rust ç¼“å­˜**: ç¼“å­˜ Rust ä¾èµ–ä»¥åŠ é€Ÿæ„å»º
6. **å®‰è£…ç³»ç»Ÿä¾èµ–** (ä»… Linux):
   - libwebkit2gtk-4.1-dev
   - libappindicator3-dev
   - librsvg2-dev
   - patchelf
   - libsoup-3.0-dev
   - libjavascriptcoregtk-4.1-dev
7. **å®‰è£…å‰ç«¯ä¾èµ–**: è¿è¡Œ `yarn install --frozen-lockfile`
8. **æ„å»º Tauri åº”ç”¨**: ä½¿ç”¨ `tauri-apps/tauri-action` æ„å»ºåº”ç”¨
9. **è‡ªåŠ¨åˆ›å»º/æ›´æ–° Release**: å¦‚æœ Release ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¦åˆ™æ›´æ–°
10. **ä¸Šä¼ åˆ¶å“**: è‡ªåŠ¨å°†æ‰€æœ‰æ„å»ºäº§ç‰©ä¸Šä¼ åˆ° GitHub Release çš„é™„ä»¶ä¸­

### è‡ªåŠ¨ä¸Šä¼ åŠŸèƒ½

Workflow ä½¿ç”¨ `tauri-apps/tauri-action@v0` çš„å†…ç½®ä¸Šä¼ åŠŸèƒ½ï¼š

- **è‡ªåŠ¨æ£€æµ‹æ„å»ºäº§ç‰©**: Action ä¼šè‡ªåŠ¨æ‰¾åˆ°æ‰€æœ‰æ„å»ºç”Ÿæˆçš„å®‰è£…åŒ…
- **æ‰¹é‡ä¸Šä¼ **: å°†æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…ä¸€æ¬¡æ€§ä¸Šä¼ åˆ° Release
- **è¦†ç›–å·²æœ‰æ–‡ä»¶**: å¦‚æœ Release ä¸­å·²å­˜åœ¨åŒåæ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨è¦†ç›–
- **é™„ä»¶å‘½å**: ä¿æŒ Tauri é»˜è®¤çš„æ–‡ä»¶å‘½åæ ¼å¼
- **å®Œæ•´æ€§éªŒè¯**: æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶éƒ½åŒ…å« SHA256 æ ¡éªŒå’Œ

## å¦‚ä½•ä½¿ç”¨

### åˆ›å»ºæ–°çš„ Release

æœ‰ä¸¤ç§æ–¹å¼åˆ›å»º releaseï¼š

#### æ–¹å¼ä¸€ï¼šé€šè¿‡ Git Tag è§¦å‘ï¼ˆæ¨èï¼‰

```bash
# 1. ç¡®ä¿æ‰€æœ‰æ›´æ”¹å·²æäº¤
git add .
git commit -m "Prepare for release v0.1.0"

# 2. åˆ›å»ºå¹¶æ¨é€ tag
git tag v0.1.0
git push origin v0.1.0

# 3. GitHub Actions ä¼šè‡ªåŠ¨ï¼š
#    - æ„å»ºæ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…
#    - åˆ›å»º GitHub Release
#    - ä¸Šä¼ æ‰€æœ‰æ„å»ºäº§ç‰©åˆ° Release
```

#### æ–¹å¼äºŒï¼šé€šè¿‡ GitHub ç•Œé¢

1. åœ¨ GitHub ä»“åº“é¡µé¢ï¼Œç‚¹å‡» "Releases"
2. ç‚¹å‡» "Create a new release"
3. å¡«å†™ä»¥ä¸‹ä¿¡æ¯:
   - **Choose a tag**: åˆ›å»ºæ–° tagï¼Œå¦‚ `v0.1.0`
   - **Release title**: å¦‚ "xuan-brain v0.1.0"
   - **Description**: å‘å¸ƒè¯´æ˜ï¼ˆæ›´æ–°å†…å®¹ã€æ–°åŠŸèƒ½ç­‰ï¼‰
4. ç‚¹å‡» "Publish release"
5. åˆ›å»º release ä¼šè‡ªåŠ¨åˆ›å»º tagï¼Œè§¦å‘æ„å»ºæµç¨‹

### ç›‘æ§æ„å»ºè¿›åº¦

1. ç‚¹å‡» "Actions" æ ‡ç­¾
2. æ‰¾åˆ°å¯¹åº”çš„ "Release Build" å·¥ä½œæµ
3. æŸ¥çœ‹æ¯ä¸ªå¹³å°çš„æ„å»ºçŠ¶æ€å’Œæ—¥å¿—

### æ„å»ºæ—¶é—´

é¢„è®¡æ„å»ºæ—¶é—´:
- Linux: çº¦ 10-15 åˆ†é’Ÿ
- macOS (ä¸¤ä¸ªæ¶æ„): å„çº¦ 15-20 åˆ†é’Ÿ
- Windows: çº¦ 15-20 åˆ†é’Ÿ

æ€»è®¡: çº¦ 1 å°æ—¶ (æ‰€æœ‰å¹³å°å¹¶è¡Œæ„å»º)

### ä¸‹è½½å®‰è£…åŒ…

æ„å»ºå®Œæˆåï¼Œå®‰è£…åŒ…ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°å¯¹åº”çš„ Release é¡µé¢ï¼š

1. è®¿é—®ä»“åº“çš„ Releases é¡µé¢
2. æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ releaseï¼ˆä¾‹å¦‚ `v0.1.0`ï¼‰
3. åœ¨ "Assets" éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…
4. ç‚¹å‡»ä¸‹è½½å¯¹åº”å¹³å°çš„å®‰è£…åŒ…

æ‰€æœ‰æ„å»ºäº§ç‰©éƒ½ä¼šè‡ªåŠ¨ä½œä¸º release é™„ä»¶ä¸Šä¼ ã€‚

## æ„å»ºäº§ç‰©

### Linux
- `xuan-brain_0.1.0_amd64.AppImage` - AppImage æ ¼å¼
- `xuan-brain_0.1.0_amd64.deb` - Debian åŒ…

### macOS
- `xuan-brain_0.1.0_x64.dmg` - Intel Mac ç£ç›˜æ˜ åƒ
- `xuan-brain_0.1.0_aarch64.dmg` - Apple Silicon ç£ç›˜æ˜ åƒ

### Windows
- `xuan-brain_0.1.0_x64_en-US.msi` - MSI å®‰è£…åŒ…
- `xuan-brain_0.1.0_x64-setup.exe` - å¯æ‰§è¡Œå®‰è£…ç¨‹åº

## æ•…éšœæ’æŸ¥

### æ„å»ºå¤±è´¥

å¦‚æœæ„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥:

1. **Cargo.toml ç‰ˆæœ¬**: ç¡®ä¿ä¸ Release tag ç‰ˆæœ¬ä¸€è‡´
2. **package.json ç‰ˆæœ¬**: ç¡®ä¿ä¸ Release tag ç‰ˆæœ¬ä¸€è‡´
3. **tauri.conf.json ç‰ˆæœ¬**: ç¡®ä¿ä¸ Release tag ç‰ˆæœ¬ä¸€è‡´
4. **ä¾èµ–é¡¹**: ç¡®ä¿æ‰€æœ‰ä¾èµ–é¡¹éƒ½å¯ä»¥æ­£å¸¸å®‰è£…
5. **æ„å»ºæ—¥å¿—**: æŸ¥çœ‹ Actions æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯ä¿¡æ¯

### å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆéœ€è¦åŒæ—¶æ„å»º macOS çš„ä¸¤ä¸ªæ¶æ„?**

A: Apple Silicon (M1/M2/M3) èŠ¯ç‰‡ä½¿ç”¨ ARM æ¶æ„ï¼Œè€Œæ—§çš„ Intel Mac ä½¿ç”¨ x86_64 æ¶æ„ã€‚ä¸ºäº†æ”¯æŒæ‰€æœ‰ Mac ç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸¤ä¸ªç‰ˆæœ¬ã€‚

**Q: å¯ä»¥æ‰‹åŠ¨è§¦å‘æ„å»ºå—?**

A: ç›®å‰å·¥ä½œæµä»…åœ¨å‘å¸ƒ Release æ—¶è§¦å‘ã€‚å¦‚éœ€æ‰‹åŠ¨æ„å»ºï¼Œå¯ä»¥åœ¨æœ¬åœ°è¿è¡Œ `yarn tauri build`ã€‚

**Q: å¦‚ä½•æ›´æ–°å·¥ä½œæµé…ç½®?**

A: ç¼–è¾‘ `.github/workflows/release.yml` æ–‡ä»¶å¹¶æäº¤æ›´æ”¹ã€‚æ›´æ”¹ä¼šåœ¨ä¸‹æ¬¡ Release æ—¶ç”Ÿæ•ˆã€‚

## æŠ€æœ¯ç»†èŠ‚

### ä½¿ç”¨çš„ GitHub Actions

- `actions/checkout@v4`: æ£€å‡ºä»£ç 
- `actions/setup-node@v4`: è®¾ç½® Node.js ç¯å¢ƒ
- `dtolnay/rust-toolchain@stable`: è®¾ç½® Rust å·¥å…·é“¾
- `swatinem/rust-cache@v2`: ç¼“å­˜ Rust ä¾èµ–
- `tauri-apps/tauri-action@v0`: Tauri å®˜æ–¹æ„å»ºå’Œå‘å¸ƒ Action

### ç¯å¢ƒå˜é‡

- `GITHUB_TOKEN`: è‡ªåŠ¨æä¾›ï¼Œç”¨äºä¸Šä¼ æ„å»ºäº§ç‰©åˆ° Release

### ç¼“å­˜ç­–ç•¥

- Rust ä¾èµ–ç¼“å­˜: åŠ é€Ÿåç»­æ„å»º
- Node.js ä¾èµ–: é€šè¿‡ `--frozen-lockfile` ç¡®ä¿ä¾èµ–ä¸€è‡´æ€§

## ç‰ˆæœ¬ç®¡ç†

åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬å‰ï¼Œè¯·ç¡®ä¿æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·:

1. `src-tauri/Cargo.toml` - `version = "x.x.x"`
2. `package.json` - `"version": "x.x.x"`
3. `src-tauri/tauri.conf.json` - `"version": "x.x.x"`

æ¨èä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·è‡ªåŠ¨æ›´æ–°è¿™äº›æ–‡ä»¶ã€‚

## å‚è€ƒèµ„æ–™

- [Tauri Actions æ–‡æ¡£](https://github.com/tauri-apps/tauri-action)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Tauri æ„å»ºæŒ‡å—](https://tauri.app/v1/guides/building/)
