# 系统托盘功能测试指南

## 构建和运行

### 开发模式测试
```bash
cd src-tauri
cargo build
cd ..
yarn tauri dev
```

### 生产模式测试
```bash
yarn tauri build
```

## 测试步骤

### 1. 启动应用
- 运行应用后，确认系统托盘区域出现 xuan-brain 图标
- 主窗口应该正常显示

### 2. 测试窗口关闭
- 点击主窗口的关闭按钮（X）
- **预期结果**: 窗口应该消失（隐藏），但应用没有退出，托盘图标仍然存在

### 3. 测试托盘单击
- 左键单击托盘图标
- **预期结果**: 主窗口重新显示并获得焦点

- 再次左键单击托盘图标
- **预期结果**: 主窗口隐藏

### 4. 测试托盘菜单
#### Windows/Linux:
- 右键单击托盘图标
- **预期结果**: 显示菜单，只包含"退出"选项

#### macOS:
- 右键单击托盘图标（或 Control + 单击）
- **预期结果**: 显示菜单，只包含"退出"选项

### 5. 测试"退出"菜单项
- 通过托盘菜单点击"退出"
- **预期结果**: 应用完全退出，托盘图标消失，所有进程终止

## 常见问题排查

### 问题 1: 托盘图标不显示
**可能原因:**
- 图标文件路径不正确
- 系统托盘支持问题（某些 Linux 桌面环境）

**解决方案:**
- 检查 `src-tauri/icons/icon.png` 文件是否存在
- 在 Linux 上确保桌面环境支持系统托盘

### 问题 2: 点击关闭后应用完全退出
**可能原因:**
- `on_window_event` 处理器未正确注册
- 代码编译错误

**解决方案:**
- 检查终端/控制台是否有编译错误
- 确认 `lib.rs` 中的 `on_window_event` 代码正确添加

### 问题 3: 托盘菜单显示为英文
**说明:**
这是预期行为，当前菜单项设置为中文：
- "退出"

如需修改，可在 `lib.rs` 的托盘菜单创建代码中修改文本。

## 验收标准

✅ 应用启动后托盘图标正常显示  
✅ 点击窗口关闭按钮后窗口隐藏到托盘  
✅ 单击托盘图标可以切换窗口显示/隐藏  
✅ 托盘右键菜单正常显示  
✅ "退出"菜单项可以完全退出应用  
✅ 窗口重新显示时位置和大小保持不变  

## 性能注意事项

- 窗口隐藏时应用仍在后台运行
- 内存占用不会因为隐藏窗口而降低
- 适合需要长期运行的应用场景
